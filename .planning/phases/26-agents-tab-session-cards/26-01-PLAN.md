---
phase: 26-agents-tab-session-cards
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ui/src/ui/navigation.ts
  - ui/src/ui/views/agents.ts
  - ui/src/ui/app-render.ts
autonomous: true

must_haves:
  truths:
    - "Agents tab appears in navigation sidebar under the Agent group with puzzle icon, title Agents, and subtitle"
    - "Clicking Agents tab navigates to /agents and renders the agents view"
    - "Session cards render from live agentSessions signal data with status indicators (thinking/executing/complete/error)"
    - "Each session card shows agent name and deterministic color identity marker"
    - "Empty state shown when agentSessions map is empty"
    - "Disconnected state shown when gateway connection is offline"
  artifacts:
    - path: "ui/src/ui/navigation.ts"
      provides: "agents tab registration"
      contains: "agents"
    - path: "ui/src/ui/views/agents.ts"
      provides: "renderAgents view function"
      exports: ["renderAgents"]
    - path: "ui/src/ui/app-render.ts"
      provides: "agents tab wiring in tab switch"
      contains: "renderAgents"
  key_links:
    - from: "ui/src/ui/views/agents.ts"
      to: "ui/src/ui/state/metrics.ts"
      via: "agentSessions signal import"
      pattern: "agentSessions"
    - from: "ui/src/ui/views/agents.ts"
      to: "ui/src/ui/state/connection.ts"
      via: "connectionStatus signal import"
      pattern: "connectionStatus|isConnected"
    - from: "ui/src/ui/views/agents.ts"
      to: "ui/src/ui/components/agent-session-card.ts"
      via: "side-effect import for custom element registration"
      pattern: "import.*agent-session-card"
    - from: "ui/src/ui/app-render.ts"
      to: "ui/src/ui/views/agents.ts"
      via: "renderAgents import and tab switch case"
      pattern: "renderAgents"
---

<objective>
Register an "Agents" tab in the OpenClaw dashboard navigation and create a view that renders live session cards from the agentSessions signal, with proper empty and disconnected states.

Purpose: Users need a dedicated tab to monitor real-time agent activity with live session cards reflecting agent status, identity, and lifecycle.
Output: Working Agents tab with navigation entry, view function, and app-render wiring -- all consuming live signal data.
</objective>

<execution_context>
@/Users/lucassenechal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucassenechal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@ui/src/ui/navigation.ts
@ui/src/ui/navigation.test.ts
@ui/src/ui/app-render.ts
@ui/src/ui/views/viz-demo.ts
@ui/src/ui/views/instances.ts
@ui/src/ui/state/metrics.ts
@ui/src/ui/state/connection.ts
@ui/src/ui/controllers/agents-controller.ts
@ui/src/ui/components/agent-session-card.ts
@ui/src/ui/icons.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register "agents" tab in navigation.ts</name>
  <files>ui/src/ui/navigation.ts</files>
  <action>
    Make 6 lockstep changes to navigation.ts to register the "agents" tab:

    1. **Tab union type**: Add `"agents"` to the Tab union type (alphabetical placement near top).

    2. **TAB_GROUPS**: Add `"agents"` to the Agent group's tabs array. The Agent group already exists with `["skills", "nodes"]`. Add "agents" as the first entry: `["agents", "skills", "nodes"]`.

    3. **TAB_PATHS**: Add `agents: "/agents"` to the TAB_PATHS record.

    4. **iconForTab**: Add case `"agents": return "puzzle";` to the switch statement. The "puzzle" icon exists in icons.ts and avoids collision with "radio" (instances), "brain" (viz), etc.

    5. **titleForTab**: Add case `"agents": return "Agents";` to the switch statement.

    6. **subtitleForTab**: Add case `"agents": return "Live agent sessions and multi-agent activity.";` to the switch statement.

    Important: The navigation.test.ts derives ALL_TABS from TAB_GROUPS, so the new tab will automatically be included in the "returns a non-empty string for every tab" tests. However, the "returns stable icons for known tabs" test has hardcoded emoji expectations -- since iconForTab returns IconName strings (not emojis), verify that adding the new case does not break existing assertions. The test file expects emoji returns but the actual function returns IconName strings like "puzzle" -- check and align with what the tests actually assert. If tests pass icon names (strings like "messageSquare"), the new case will pass. If they assert emojis, the test file may need a new assertion added for "agents".
  </action>
  <verify>
    Run `pnpm test -- ui/src/ui/navigation.test.ts` and confirm all tests pass, including the derived TAB_GROUPS tests that auto-cover the new "agents" tab. Run `pnpm build` to confirm no type errors.
  </verify>
  <done>
    "agents" appears in Tab type, TAB_GROUPS Agent group, TAB_PATHS, iconForTab (returns "puzzle"), titleForTab (returns "Agents"), subtitleForTab (returns descriptive string). All navigation tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create agents view and wire into app-render</name>
  <files>
    ui/src/ui/views/agents.ts
    ui/src/ui/app-render.ts
  </files>
  <action>
    **Create `ui/src/ui/views/agents.ts`:**

    Follow the pattern established by viz-demo.ts (pure function returning html TemplateResult). The view function signature is `renderAgents()` with no props -- it reads directly from signals.

    Imports needed:
    - `html, nothing` from "lit"
    - `agentSessions` from "../state/metrics" (the signal)
    - `connectionStatus` from "../state/connection" (the signal)
    - Side-effect import: `"../components/agent-session-card"` (registers the custom element)

    Implementation:
    1. Read `connectionStatus.get()` -- if "disconnected", render a disconnected state callout: a `<div class="card">` containing a message like "Gateway disconnected. Connect to see live agent sessions." with a connection-indicator element. Use the existing card/callout CSS classes from the dashboard.

    2. Read `agentSessions.get()` -- get all values as an array of SessionCardData.

    3. If connected but sessions array is empty, render an empty state: a `<div class="card">` with a message like "No active agent sessions." and a subtle subtitle "Sessions will appear here when agents are spawned."

    4. If sessions exist, render a grid of `<agent-session-card>` elements. Use a flex-wrap container (same pattern as viz-demo.ts: `display:flex;gap:16px;flex-wrap:wrap;`). For each SessionCardData entry, render:
    ```html
    <agent-session-card
      sessionKey="${entry.sessionKey}"
      agentId="${entry.agentId}"
      task="${entry.task}"
      status="${entry.status}"
      .startedAt=${entry.startedAt}
      .endedAt=${entry.endedAt}
      spawnedBy="${entry.spawnedBy || ''}"
      currentStep="${entry.currentStep || ''}"
    ></agent-session-card>
    ```

    Use lit's `nothing` for conditional rendering. Use `.property=` syntax for numeric properties (startedAt, endedAt) and attribute syntax for strings.

    Handle `endedAt` and `spawnedBy` being undefined -- only set attribute if value exists, or pass empty string for string attributes and use conditional for .endedAt (only set if defined, otherwise omit or pass undefined).

    Export the function: `export function renderAgents() { ... }`

    **Wire into `ui/src/ui/app-render.ts`:**

    1. Add import at top with the other view imports:
       `import { renderAgents } from "./views/agents";`

    2. In the `renderApp` function's main content section, add the agents tab case. Follow the existing pattern -- it goes in the tab switch chain. Add it near the other simple tab cases. Since renderAgents() takes no props (reads signals directly), the pattern is identical to viz-demo:
       `${state.tab === "agents" ? renderAgents() : nothing}`

    Place this line near the existing viz case (line ~604 area) since both are simple no-props view functions.

    Important: Do NOT import agentSessions or connectionStatus in app-render.ts -- the view function handles its own signal reads internally. This keeps app-render.ts clean and matches how renderVizDemo() works.
  </action>
  <verify>
    Run `pnpm build` to confirm no type errors across all files. Run `pnpm test` to confirm no regressions. Verify the new file exists at `ui/src/ui/views/agents.ts` and exports `renderAgents`.
  </verify>
  <done>
    `renderAgents()` function exists in views/agents.ts, reads agentSessions and connectionStatus signals, renders agent-session-card elements for each session, shows empty state when no sessions, shows disconnected state when gateway is offline. app-render.ts has the agents tab case wired in.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` passes with zero type errors
2. `pnpm test -- ui/src/ui/navigation.test.ts` -- all navigation tests pass (including derived TAB_GROUPS tests)
3. `pnpm test` -- full test suite passes with no regressions
4. Grep confirms wiring:
   - `grep "agents" ui/src/ui/navigation.ts` shows all 6 registration points
   - `grep "renderAgents" ui/src/ui/app-render.ts` shows the import and tab case
   - `grep "agentSessions" ui/src/ui/views/agents.ts` shows signal consumption
   - `grep "connectionStatus" ui/src/ui/views/agents.ts` shows connection state check
   - `grep "agent-session-card" ui/src/ui/views/agents.ts` shows side-effect import
</verification>

<success_criteria>
- "Agents" tab is registered in navigation with puzzle icon, title, subtitle, /agents path, in Agent group
- renderAgents view function renders agent-session-card elements from live agentSessions signal
- Disconnected state renders when connectionStatus is "disconnected"
- Empty state renders when connected but agentSessions map is empty
- app-render.ts routes "agents" tab to renderAgents()
- All tests pass, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/26-agents-tab-session-cards/26-01-SUMMARY.md`
</output>
