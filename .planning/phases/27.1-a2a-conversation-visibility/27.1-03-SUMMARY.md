---
phase: 27.1-a2a-conversation-visibility
plan: 03
subsystem: ui-rendering
tags:
  - a2a
  - lit
  - typescript
  - threaded-chat
  - conversation-ui
requires:
  - 27.1-02
provides:
  - renderA2AConversation threaded chat view
  - A2A conversation badge on session cards
  - A2A drill-down routing from session list
affects:
  - future-a2a-features
tech-stack:
  added: []
  patterns:
    - "Left/right chat bubble alignment for bi-directional conversations"
    - "Badge overlay pattern for session card indicators"
key-files:
  created: []
  modified:
    - ui/src/ui/views/conversation-view.ts
    - ui/src/ui/views/agents.ts
decisions:
  - id: left-right-alignment
    choice: "Requester agent messages left-aligned, target agent messages right-aligned"
    rationale: "Visual distinction for two-party conversation - mirrors chat app conventions"
  - id: badge-click-routing
    choice: "A2A badge click uses stopPropagation and routes to A2A view; card click routes to session conversation"
    rationale: "Session card serves dual purpose - regular conversation primary, A2A conversation secondary"
  - id: shared-scroll-state
    choice: "Reuse module-level userScrolledUp flag from renderConversation"
    rationale: "Consistent auto-scroll pattern across all conversation views"
metrics:
  duration: 4 min
  completed: 2026-02-03
---

# Phase 27.1 Plan 03: A2A Conversation Rendering

**Threaded A2A chat view with left/right message alignment, agent avatars, turn numbers, and blue A2A session card badges with drill-down routing.**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-03T23:11:09Z
- **Completed:** 2026-02-03T23:15:24Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- Threaded A2A conversation view with interleaved two-agent messages
- Session cards show clickable A2A badge when conversations exist
- Drill-down routing from session list to A2A view and back
- Auto-scroll with scroll-to-bottom button for active conversations
- Active/complete status badge for conversation state

## Task Commits

Each task was committed atomically:

1. **Task 1: Add A2A threaded conversation renderer** - `cb8608ea7` (feat)
2. **Task 2: Add A2A indicators and routing to agents tab** - `f44d46029` (feat)

## Files Created/Modified

**ui/src/ui/views/conversation-view.ts** (~220 LOC added):

- Added `renderA2AConversation` export function
- Imports `a2aConversations` signal and `A2AConversation` type
- Renders threaded chat with left/right alignment based on requester vs target
- Shows agent avatars, turn numbers, timestamps
- Markdown rendering in message bubbles
- Auto-scroll pattern matching existing `renderConversation`
- Typing indicator for active conversations
- Active/complete status badge

**ui/src/ui/views/agents.ts** (~35 LOC added):

- Imports `sessionA2ALinks`, `a2aConversations`, and `renderA2AConversation`
- Added `selectedA2AConversation` signal for A2A drill-down state
- A2A view routing in `renderAgentSessions` (precedes regular session routing)
- Blue "A2A" badge on session cards with related conversations
- Badge positioned absolutely in top-right corner
- Badge click opens A2A view (stopPropagation prevents card click)
- Card click opens regular session conversation

## Decisions Made

**Left/right message alignment:**
Requester agent messages appear left-aligned, target agent messages right-aligned. This mirrors standard chat UI conventions and provides clear visual distinction in a two-party conversation.

**Badge click routing:**
Session cards serve dual purpose - clicking the card opens the regular session conversation, clicking the A2A badge opens the threaded A2A view. `stopPropagation` on the badge prevents the card's click handler from firing.

**Shared scroll state:**
Reused the module-level `userScrolledUp` flag from `renderConversation` for consistent auto-scroll behavior across all conversation views.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

A2A conversations are now fully visible in the Agents tab:

- Session cards show A2A badge when conversations exist
- Clicking the badge opens a threaded back-and-forth chat view
- Messages are visually distinguished by left/right alignment
- Agent avatars, names, colors, turn numbers, and timestamps are all displayed
- Markdown content renders correctly in message bubbles
- Auto-scroll keeps view at bottom during active conversations
- Status badge shows active vs complete state

**Blockers:** None

**Concerns:** None

## Success Criteria

- [x] `renderA2AConversation` exported from conversation-view.ts
- [x] Reads `a2aConversations` signal
- [x] Uses `getAgentIdentity` for agent name/color
- [x] Messages left/right aligned based on requester vs target
- [x] Auto-scroll pattern matches existing convention
- [x] `sessionA2ALinks` and `a2aConversations` imported in agents.ts
- [x] `renderA2AConversation` imported from conversation-view
- [x] `selectedA2AConversation` signal exists
- [x] A2A view routing precedes regular session routing
- [x] Session cards show A2A badge when sessionA2ALinks has entries
- [x] Clicking A2A badge sets selectedA2AConversation (with stopPropagation)
- [x] `pnpm build` passes with no TypeScript errors

---

**Phase:** 27.1-a2a-conversation-visibility
**Plan:** 03
**Completed:** 2026-02-03
**Duration:** 4 minutes
