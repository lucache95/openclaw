# Milestone v1.0: OpenClaw Optimization

**Status:** SHIPPED 2026-02-02
**Phases:** 1-7
**Total Plans:** 21

## Overview

Optimized Lucas's existing OpenClaw setup to solve the critical 173k token context overflow problem. The sequence prioritized context survival first (stop the bleeding), then local LLM infrastructure (cost savings), security hardening (credentials before integrations), sub-agent patterns (prepare for parallel work), secondary provider integration (MiniMax for workers), and documentation (capture learnings). Each phase delivered a verifiable capability that supports the core value: context must survive.

## Phases

### Phase 1: Setup

**Goal**: Establish controlled fork with upstream tracking for safe optimization work
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:

- [x] 01-01: Fork OpenClaw, build from source, add upstream sync workflow

**Details:**

- Fork created as lucache95/openclaw on GitHub
- Local installation runs latest version (2026.1.30)
- Upstream remote configured with sync check script

---

### Phase 2: Context Survival

**Goal**: Prevent context overflow crashes and preserve critical state during compaction
**Depends on**: Phase 1
**Plans**: 5 plans

Plans:

- [x] 02-01: Implement ACTIVE.md bootstrap file with read/write functions
- [x] 02-02: Add context monitoring with tiered thresholds (70/80/90%)
- [x] 02-03: Extend compaction to preserve decisions/constraints and pre-flush ACTIVE.md
- [x] 02-04: Wire context threshold state into agent execution
- [x] 02-05: Wire status display helpers into status command (gap closure)

**Details:**

- ACTIVE.md (WORKING.md) file exists and updates before every compaction
- Token usage displays warnings at 70%, 80%, and 90% thresholds
- Compaction preserves file paths, decisions, and constraints
- Agent recovers working state from ACTIVE.md after restart or compaction

---

### Phase 3: Local LLM

**Goal**: Offload simple tasks to free local inference, reducing Claude Max usage
**Depends on**: Phase 2
**Plans**: 4 plans

Plans:

- [x] 03-01: Install Ollama natively and pull qwen2.5:3b + nomic-embed-text models
- [x] 03-02: Add Ollama as embedding provider in OpenClaw memory system
- [x] 03-03: Implement task routing logic (simple -> Ollama, complex -> Claude)
- [x] 03-04: Wire task router into agent execution pipeline (gap closure)

**Details:**

- Ollama runs natively on macOS with Metal GPU acceleration
- qwen2.5:3b model responds to prompts within 2 seconds
- nomic-embed-text generates embeddings for memory search
- Simple tasks route to Ollama instead of Claude

---

### Phase 4: Security

**Goal**: Eliminate plaintext credentials and automate security monitoring
**Depends on**: Phase 3
**Plans**: 4 plans

Plans:

- [x] 04-01: Set up GPG vault infrastructure (pass, detect-secrets, GPG key)
- [x] 04-02: Migrate credentials from plaintext files to encrypted vault
- [x] 04-03: Create automated security audit with daily scanning
- [x] 04-04: Remove plaintext credential files (gap closure)

**Details:**

- No credentials remain in config.json (moved to Keychain)
- GPG encrypted vault stores sensitive credentials with owner tags
- Daily security audit script runs via launchd and reports findings

---

### Phase 5: Sub-agents

**Goal**: Enable clean delegation to sub-agents with structured handoff and return
**Depends on**: Phase 4
**Plans**: 2 plans

Plans:

- [x] 05-01: Create delegation brief templates with task-type patterns
- [x] 05-02: Define result aggregation format with parsing and formatting

**Details:**

- DelegationBrief interface with objective, context, constraints, output format
- TaskTypeTemplates for research, code, analysis, routine tasks
- RESULT_MARKERS for structured sub-agent returns
- parseSubagentResult for response aggregation

---

### Phase 6: Secondary Provider

**Goal**: Add MiniMax as cheap cloud provider for worker agents (95% cost reduction)
**Depends on**: Phase 5
**Plans**: 3 plans

Plans:

- [x] 06-01: Create MiniMax M2 client with Keychain credential retrieval
- [x] 06-02: Extend TaskRouter with three-tier classification (local/cheap/quality)
- [x] 06-03: Integrate three-tier routing into agent pipeline with cost tracking

**Details:**

- MiniMax M2 API credentials stored in Keychain
- Three-tier routing: Ollama (free) / MiniMax (cheap) / Claude (quality)
- Cost tracking with globalCostTracker singleton

---

### Phase 7: Documentation

**Goal**: Capture multi-agent patterns and learnings for future fleet deployment
**Depends on**: Phase 6
**Plans**: 2 plans

Plans:

- [x] 07-01: Document implemented patterns (delegation briefs, context survival, cost routing)
- [x] 07-02: Document fleet deployment patterns and create quick reference

**Details:**

- 5 brain-docs concept files covering all patterns
- LESSONS-LEARNED.md with project decisions and metrics
- PATTERNS.md quick reference with decision trees

---

## Milestone Summary

**Key Decisions:**

- Use Ollama qwen2.5:3b as primary local model (fast, small, good for simple tasks)
- ACTIVE.md for hot context recovery (Glenn's recommended pattern)
- Keep existing cron jobs as-is (they work; don't fix what isn't broken)
- Fork created as lucache95/openclaw (not openclaw-fork)
- Build via pnpm (consistent with upstream)
- Weekly sync checks on Mondays at 8am UTC
- Use 70/80/90% thresholds (yellow/orange/red) for progressive warnings
- Use Keychain for script access (avoids GPG passphrase prompts)
- Temperature clamped to (0.01, 1.0] for MiniMax (rejects 0)
- THREE_TIER_ROUTING_ENABLED defaults to true (immediate activation)

**Issues Resolved:**

- 173k token context overflow crashes
- Plaintext credentials in config files
- No local inference capability
- Missing structured sub-agent handoff

**Issues Deferred:**

- Multi-agent fleet deployment (v2 milestone)
- Buggy Xcode app fix (separate project)
- Full Mission Control infrastructure

**Technical Debt Incurred:**

- Three-tier routing currently disabled (classification issues being addressed)
- Pattern-based routing improvements pending

---

_Archived: 2026-02-02 as part of v1.0 milestone completion_
